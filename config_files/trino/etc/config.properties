
##########################################
# Coordinator and Scheduling
##########################################
coordinator=true
node-scheduler.include-coordinator=true
query.max-memory=4GB
query.max-memory-per-node=1GB

# Optional but helpful if your service DNS is "trino"
#node.internal-address=trino


##########################################
# HTTP / HTTPS Listeners
##########################################
# Internal HTTP (for discovery & workers)
http-server.http.enabled=false
#http-server.http.port=8080

# External HTTPS (for users + OAuth2)
http-server.https.enabled=true
# IMPORTANT: listen on 8443 *inside* the container (compose maps 8444:8443)
http-server.https.port=8443
http-server.https.keystore.path=/etc/trino/keystore/trino-keystore.p12
http-server.https.keystore.key=changeit
# (Do NOT set http-server.https.keystore.type â€” Trino infers PKCS12 from the .p12)

# Discovery must point to internal listener and resolvable host for *other containers*
# (avoid localhost so workers/sidecars can reach it)
discovery.uri=https://trino:8443

##########################################
# Authentication (Keycloak OIDC / OAuth2)
##########################################
http-server.authentication.type=oauth2
http-server.authentication.oauth2.client-id=trino
http-server.authentication.oauth2.client-secret=password
http-server.authentication.oauth2.scopes=openid,profile,email
http-server.authentication.oauth2.state-key=<long-random-stable-string>


# Issuer must be reachable from inside the Trino container
# (adjust host/port to match your Keycloak service)
http-server.authentication.oauth2.issuer=https://keycloak.local:8443/realms/OSSS
http-server.authentication.oauth2.principal-field=preferred_username
http-server.authentication.oauth2.oidc.discovery=false

# Give Trino explicit endpoints that are REACHABLE from inside the container.
# Use the Docker service name + the container?s internal TLS port.
http-server.authentication.oauth2.auth-url=https://keycloak.local:8443/realms/OSSS/protocol/openid-connect/auth
http-server.authentication.oauth2.token-url=https://keycloak.local:8443/realms/OSSS/protocol/openid-connect/token
http-server.authentication.oauth2.jwks-url=https://keycloak.local:8443/realms/OSSS/protocol/openid-connect/certs



##########################################
# Web UI
##########################################
web-ui.enabled=true
# Required for OAuth2 in the UI
web-ui.authentication.type=oauth2

##########################################
# Internal comms (auth enabled -> set a secret)
##########################################
internal-communication.shared-secret=3H1pHXaRiMIkcXUWJrPL5+dkBl3HNQr+mupaSMQDPuGrNQqKZCs4l9lPQYnx8BaB

http-server.log.enabled=true
# http-server.log.path=/var/trino/data/var/log

# Persist/verify OAuth state (32+ chars, random)
http-server.authentication.oauth2.state-key=please-change-me-to-a-long-random-secret

# Allow refresh tokens for smoother re-login
http-server.authentication.oauth2.refresh-tokens=true

#If you ever put Trino behind a reverse proxy/ingress (Traefik/Nginx/etc.), uncomment so it honors X-Forwarded-* headers:
# http-server.process-forwarded=true

internal-communication.https.required=true
internal-communication.https.truststore.path=/etc/trino/keystore/truststore.jks
internal-communication.https.truststore.key=changeit
