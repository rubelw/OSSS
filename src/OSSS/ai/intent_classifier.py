from __future__ import annotations

from typing import Optional, Any, Dict, List
import httpx
import logging
import json
import re
from pydantic import BaseModel

from OSSS.ai.intents import Intent

logger = logging.getLogger("OSSS.ai.intent_classifier")

# --- SAFE SETTINGS IMPORT (same pattern as rag_router) -----------------
try:
    from OSSS.config import settings as _settings  # type: ignore

    settings = _settings
except Exception:
    # Fallback for local/dev or tests
    class _Settings:
        VLLM_ENDPOINT: str = "http://host.containers.internal:11434"
        INTENT_MODEL: str = "llama3.2-vision"

    settings = _Settings()  # type: ignore


class IntentResult(BaseModel):
    intent: Intent
    confidence: Optional[float] = None
    raw: Optional[dict] = None

    # CRUD-style action classification
    # action ∈ {"read", "create", "update", "delete"} (or None if unknown)
    action: Optional[str] = None
    action_confidence: Optional[float] = None

    # Urgency classification for routing / triage
    # urgency ∈ {"low", "medium", "high"} (or None if unknown)
    urgency: Optional[str] = None
    urgency_confidence: Optional[float] = None

    # Tone classification
    tone_major: Optional[str] = None
    tone_major_confidence: Optional[float] = None
    tone_minor: Optional[str] = None
    tone_minor_confidence: Optional[float] = None

    # Raw LLM/heuristic output string (for UI / debug)
    # NOTE: raw_model_content is kept for back-compat; raw_model_output is the new
    # unified field that the router exposes as `intent_raw_model_output`.
    raw_model_content: Optional[str] = None
    raw_model_output: Optional[str] = None

    # Optional: where this result came from ("heuristic", "llm", "fallback")
    source: Optional[str] = None


# ---------------------------------------------------------------------------
# Heuristic rule model + table (scalable for many patterns)
# ---------------------------------------------------------------------------

class IntentHeuristicRule(BaseModel):
    """
    A simple, config-like rule for matching text to an intent without
    calling the LLM.

    - If any `contains_any` keyword is found (case-insensitive), the rule matches.
    - If `regex` is provided and matches, the rule matches.
    - If either condition matches, the rule fires.
    """
    name: str

    # matching
    contains_any: List[str] = []
    regex: Optional[str] = None

    # what intent/action to return
    intent: str
    action: Optional[str] = "read"
    urgency: Optional[str] = "low"
    tone_major: Optional[str] = "informal_casual"
    tone_minor: Optional[str] = "friendly"

    # optional extra metadata if you ever want to propagate it later
    metadata: Dict[str, Any] = {}


HEURISTIC_RULES: List[IntentHeuristicRule] = [
    # -------------------- Existing Rules --------------------
    IntentHeuristicRule(
        name="scorecards_query",
        contains_any=["scorecard", "scorecards"],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "scorecards"},
    ),
    IntentHeuristicRule(
        name="immunization_records_query_rule",
        contains_any=["immunization records", "student immunizations", "student shots"],
        intent="query_data",
        action="read",
        metadata={"mode": "immunization_records"},
    ),
    IntentHeuristicRule(
        name="incident_participants_query_rule",
        contains_any=[
            "incident_participants",          # snake_case
            "incident participants",          # with space
            "show incident participants",     # full phrase you just tried
            "show incident_participants",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "incident_participants"},
    ),
    IntentHeuristicRule(
        name="person_addresses_query_rule",
        contains_any=[
            "person addresses",
            "person_addresses",
            "show person addresses",
            "show person_addresses",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "person_addresses"},
    ),
    IntentHeuristicRule(
        name="addresses_query_rule",
        contains_any=["addresses", "show addresses", "addresses query"],
        intent="query_data",
        action="read",
        metadata={"mode": "addresses"},
    ),
    IntentHeuristicRule(
        name="attendance_daily_summary_query_rule",
        contains_any=[
            "attendance daily summary",
            "attendance_daily_summary",
            "daily attendance summary",
            "attendance rate",
            "show daily attendance",
            "list daily attendance",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "attendance_daily_summary"},
    ),
    IntentHeuristicRule(
        name="attendance_codes_query_rule",
        contains_any=[
            "attendance codes",
            "attendance_codes",
            "absence codes",
            "tardy codes",
            "show attendance codes",
            "list attendance codes",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "attendance_codes"},
    ),
    IntentHeuristicRule(
        name="attendance_events_query_rule",
        contains_any=[
            "attendance events",
            "attendance_events",
            "check in",
            "check out",
            "check-in events",
            "attendance kiosk events",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "attendance_events"},
    ),
    IntentHeuristicRule(
        name="attendance_query_rule",
        contains_any=[
            "show attendance",
            "show attendances",
            "attendance events",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "attendances"},  # MUST MATCH handler.mode
    ),
    IntentHeuristicRule(
        name="work_order_time_logs_query_rule",
        contains_any=[
            "work order time logs",
            "work_order_time_logs",
            "work order logs",
            "time logs",
            "show work order time logs",
            "show time logs",
            "maintenance time logs",
            "wo logs",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "work_order_time_logs"}
    ),
    IntentHeuristicRule(
        name="work_order_tasks_query_rule",
        contains_any=[
            "work order tasks",
            "work_order_tasks",
            "wo tasks",
            "maintenance tasks",
            "task list",
            "work order task list",
            "show work order tasks",
            "show tasks for work orders",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "work_order_tasks"},
    ),
    IntentHeuristicRule(
        name="work_order_parts_query_rule",
        contains_any=[
            "work order parts",
            "work_order_parts",
            "wo parts",
            "parts used",
            "parts used on work orders",
            "maintenance parts",
            "show work order parts",
            "show parts used",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "work_order_parts"},
    ),
    IntentHeuristicRule(
        name="user_accounts_query_rule",
        contains_any=[
            "user accounts",
            "user_accounts",
            "show user accounts",
            "login accounts",
            "portal accounts",
            "osss accounts",
            "account list",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "user_accounts"},
    ),
    IntentHeuristicRule(
        name="ticket_types_query_rule",
        contains_any=[
            "ticket types",
            "ticket_types",
            "show ticket types",
            "list ticket types",
            "helpdesk ticket types",
            "support ticket types",
            "it ticket types",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "ticket_types"},
    ),
    IntentHeuristicRule(
        name="ticket_scans_query_rule",
        contains_any=[
            "ticket scans",
            "ticket_scans",
            "show ticket scans",
            "show ticket_scans",
            "scan logs",
            "ticket scan logs",
            "ticket check-ins",
            "ticket checkins",
            "gate scans",
            "entry scans",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "ticket_scans"},
    ),
    IntentHeuristicRule(
        name="tickets_query_rule",
        contains_any=[
            "tickets",
            "ticket list",
            "show tickets",
            "ticket inventory",
            "ticket sales",
            "event tickets",
            "tickets report",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "tickets"},
    ),
    IntentHeuristicRule(
        name="work_orders_query_rule",
        contains_any=[
            "work orders",
            "work_orders",
            "maintenance work orders",
            "maintenance tickets",
            "show work orders",
            "show maintenance work orders",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "work_orders"},
    ),
    IntentHeuristicRule(
        name="webhooks_query_rule",
        contains_any=[
            "webhooks",
            "webhook list",
            "show webhooks",
            "outbound webhooks",
            "event webhooks",
            "callback webhooks",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "webhooks"},
    ),
    IntentHeuristicRule(
        name="warranties_query_rule",
        contains_any=[
            "warranties",
            "warranty",
            "asset warranty",
            "equipment warranties",
            "show warranties",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "warranties"},
    ),
    IntentHeuristicRule(
        name="waivers_query_rule",
        contains_any=[
            "waivers",
            "waiver",
            "student waivers",
            "fee waiver",
            "program waiver",
            "show waivers",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "waivers"},
    ),
    IntentHeuristicRule(
        name="votes_query_rule",
        contains_any=[
            "votes",
            "vote records",
            "voting records",
            "ballot votes",
            "show votes",
            "list votes",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "votes"},
    ),
    IntentHeuristicRule(
        name="vendors_query_rule",
        contains_any=[
            "vendors",
            "vendor list",
            "vendor records",
            "supplier",
            "suppliers",
            "approved vendors",
            "list vendors",
            "show vendors",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "vendors"},
    ),
    IntentHeuristicRule(
        name="users_query_rule",
        contains_any=[
            "users",
            "user list",
            "list users",
            "show users",
            "system users",
            "application users",
            "auth users",
            "registered users",
            "login accounts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "users"},
    ),
    IntentHeuristicRule(
        name="transcript_lines_query_rule",
        contains_any=[
            "transcript lines",
            "transcript_lines",
            "show transcript lines",
            "show transcript_lines",
            "transcript line data",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "transcript_lines"},
    ),
    IntentHeuristicRule(
        name="test_results_query_rule",
        contains_any=[
            "test results",
            "test_results",
            "show test results",
            "show test_results",
            "assessment results",
            "exam results",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "test_results"},
    ),
    IntentHeuristicRule(
        name="test_administrations_query_rule",
        contains_any=[
            "test administrations",
            "test_administrations",
            "show test administrations",
            "show test_administrations",
            "assessment administrations",
            "testing sessions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "test_administrations"},
    ),
    IntentHeuristicRule(
        name="teacher_section_assignments_query_rule",
        contains_any=[
            "teacher section assignments",
            "teacher_section_assignments",
            "teacher assignment sections",
            "teacher-section assignments",
            "show teacher section assignments",
            "list teacher section assignments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "teacher_section_assignments"},
    ),
    IntentHeuristicRule(
        name="tags_query_rule",
        contains_any=[
            "tags",
            "list tags",
            "tag list",
            "show tags",
            "all tags",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "tags"},
    ),
    IntentHeuristicRule(
        name="subscriptions_query_rule",
        contains_any=[
            "subscriptions",
            "list subscriptions",
            "subscription list",
            "show subscriptions",
            "all subscriptions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "subscriptions"},
    ),
    IntentHeuristicRule(
        name="subjects_query_rule",
        contains_any=[
            "subjects",
            "course subjects",
            "subject list",
            "list subjects",
            "show subjects",
            "all subjects",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "subjects"},
    ),
    IntentHeuristicRule(
        name="student_transportation_assignments_query_rule",
        contains_any=[
            "student transportation assignments",
            "student_transportation_assignments",
            "transportation assignments",
            "bus assignments",
            "student bus assignments",
            "show transportation assignments",
            "show student transportation",
            "list transportation assignments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "student_transportation_assignments"},
    ),
    IntentHeuristicRule(
        name="student_section_enrollments_query_rule",
        contains_any=[
            "student section enrollments",
            "student_section_enrollments",
            "section enrollments",
            "student class enrollments",
            "student schedule enrollments",
            "class enrollments",
            "student enrollment list",
            "show student enrollments",
            "list student enrollments",
            "show section enrollments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "student_section_enrollments"},
    ),
    IntentHeuristicRule(
        name="student_school_enrollments_query_rule",
        contains_any=[
            "student school enrollments",
            "student_school_enrollments",
            "school enrollments",
            "student school enrollment list",
            "student enrollment by school",
            "student building enrollments",
            "school-level student enrollments",
            "show student school enrollments",
            "list student school enrollments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "student_school_enrollments"},
    ),
    IntentHeuristicRule(
        name="student_program_enrollments_query_rule",
        contains_any=[
            "student program enrollments",
            "student_program_enrollments",
            "program enrollments",
            "student program enrollment list",
            "student program roster",
            "program-level student enrollments",
            "show student program enrollments",
            "list student program enrollments",
            "student program participation",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "student_program_enrollments"},
    ),
    IntentHeuristicRule(
        name="student_guardians_query_rule",
        contains_any=[
            "student_guardians",
            "student guardians",
            "guardian list",
            "student guardian list",
            "list student guardians",
            "show student guardians",
            "guardian info",
            "guardian information",
            "parent contacts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "student_guardians"},
    ),
    IntentHeuristicRule(
        name="states_query_rule",
        contains_any=[
            "states",
            "state list",
            "list of states",
            "us states",
            "state codes",
            "state abbreviations",
            "show states",
            "show state list",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "states"},
    ),
    IntentHeuristicRule(
        name="state_reporting_snapshots_query_rule",
        contains_any=[
            "state reporting snapshots",
            "state reporting snapshot",
            "state reporting export",
            "state reporting submission",
            "state reporting file",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "state_reporting_snapshots"},
    ),
    IntentHeuristicRule(
        name="standards_query_rule_custom",
        contains_any=[
            "learning standards",
            "academic standards",
            "state standards",
            "iowa core standards",
            "ngss standards",
            "common core standards",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "standards"},
    ),
    IntentHeuristicRule(
        name="standardized_tests_query_rule",
        contains_any=[
            "standardized tests",
            "standardized_tests",
            "show standardized tests",
            "list standardized tests",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="friendly",
        metadata={"mode": "standardized_tests"},
    ),
    IntentHeuristicRule(
        name="staff_query_rule",
        contains_any=[
            # generic table / API phrases
            "staff",
            "staff list",
            "staff directory",
            "show staff",
            "list staff",
            # common school-language ways to ask for this data
            "teacher list",
            "teachers list",
            "teacher directory",
            "employee directory",
            "district staff",
            "school staff",
            "who works at",
            "which teachers",
        ],
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "staff"},
    ),

    IntentHeuristicRule(
        name="special_education_cases_query_rule",
        contains_any=[
            "special education cases",
            "special_education_cases",
            "special ed cases",
            "special education caseload",
            "sped cases",
            "iep cases",
            "special ed students",
            "special education students",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "special_education_cases"},
    ),
    IntentHeuristicRule(
        name="spaces_query_rule",
        contains_any=[
            "space list",
            "facility spaces",
            "rooms and spaces",
            "building spaces",
            "available spaces",
            "list spaces",
            "show spaces",
            "classroom spaces",
            "meeting spaces",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "spaces"},
    ),
    IntentHeuristicRule(
        name="space_reservations_query_rule",
        contains_any=[
            "space reservations",
            "space_reservations",
            "facility reservations",
            "room reservations",
            "gym reservations",
            "auditorium reservations",
            "who has this space",
            "who has the gym reserved",
            "which spaces are reserved",
            "calendar of space reservations",
            "list space reservations",
            "show space reservations",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "space_reservations"},
    ),
    IntentHeuristicRule(
        name="sis_import_jobs_query_rule",
        contains_any=[
            "sis import jobs",
            "sis_import_jobs",
            "SIS import history",
            "SIS sync jobs",
            "SIS sync runs",
            "import job status",
            "SIS imports",
            "student information system imports",
            "show sis import jobs",
            "list sis import jobs",
            "when did the last sis import run",
            "last sis import job",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "sis_import_jobs"},
    ),
    IntentHeuristicRule(
        name="section_room_assignments_query_rule",
        contains_any=[
            "section room assignments",
            "section_room_assignments",
            "room assignments by section",
            "classroom assignments",
            "section classroom assignments",
            "classroom for this section",
            "what room is this section in",
            "which room is this section in",
            "schedule room assignments",
            "show section room assignments",
            "list section room assignments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "section_room_assignments"},
    ),
    IntentHeuristicRule(
        name="section_meetings_query_rule",
        contains_any=[
            "section meetings",
            "section_meetings",
            "class meeting times",
            "meeting times for this section",
            "when does this section meet",
            "what time does this class meet",
            "section meeting schedule",
            "class schedule meeting",
            "class meets at",
            "meeting schedule for section",
            "list section meetings",
            "show section meetings",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "section_meetings"},
    ),
    IntentHeuristicRule(
        name="section504_plans_query_rule",
        contains_any=[
            "section504_plans",
            "section504 plans",
            "504 plans",
            "section 504 plans",
            "student 504 plan",
            "student 504 plans",
            "504 accommodations",
            "504 services",
            "which students have 504",
            "who has a 504 plan",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "section504_plans"},
    ),
    IntentHeuristicRule(
        name="scorecard_kpis_query_rule",
        contains_any=[
            "scorecard kpis",
            "scorecard_kpis",
            "kpis on scorecards",
            "plan kpis",
            "plan kpi",
            "performance indicators",
            "scorecard metrics",
            "plan metrics",
            "kpi list",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "scorecard_kpis"},
    ),
    IntentHeuristicRule(
        name="schools_query_rule",
        contains_any=[
            "school list",
            "list schools",
            "district schools",
            "school buildings",
            "school directory",
            "which schools",
            "what schools do we have",
            "elementary schools",
            "middle schools",
            "high schools",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "schools"},
    ),
    IntentHeuristicRule(
        name="scan_results_query_rule",
        contains_any=[
            "scan results",
            "scan_results",
            "security scan",
            "security scans",
            "scan findings",
            "scan output",
            "scanner results",
            "vulnerability scan results",
            "show scan results",
            "list scan results",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "scan_results"},
    ),
    IntentHeuristicRule(
        name="scan_requests_query_rule",
        contains_any=[
            "scan requests",
            "scan_requests",
            "show scan requests",
            "list scan requests",
            "queued scans",
            "pending scans",
            "scheduled scans",
            "requested scans",
            "scan job queue",
            "scan request queue",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "scan_requests"},
    ),
    IntentHeuristicRule(
        name="round_decisions_query_rule",
        contains_any=[
            "round decisions",
            "round_decisions",
            "review round decisions",
            "proposal round decisions",
            "decision rounds",
            "round decision list",
            "show round decisions",
            "list round decisions",
            "review decisions by round",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "round_decisions"},
    ),
    IntentHeuristicRule(
        name="rooms_query_rule",
        contains_any=[
            "rooms",
            "room list",
            "school rooms",
            "classrooms",
            "classroom list",
            "what rooms",
            "which rooms",
            "building rooms",
            "list rooms",
            "show rooms",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "rooms"},
    ),
    IntentHeuristicRule(
        name="roles_query_rule",
        contains_any=[
            "roles",
            "role list",
            "user roles",
            "system roles",
            "permission roles",
            "district roles",
            "teacher roles",
            "staff roles",
            "which roles",
            "show roles",
            "list roles",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "roles"},
    ),
    IntentHeuristicRule(
        name="role_permissions_query_rule",
        contains_any=[
            "role permissions",
            "role_permissions",
            "permissions for role",
            "permissions by role",
            "what can this role do",
            "what can admins do",
            "what can teachers do",
            "role access",
            "role privileges",
            "list role permissions",
            "show role permissions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "role_permissions"},
    ),
    IntentHeuristicRule(
        name="reviews_query_rule",
        contains_any=[
            "reviews",
            "review records",
            "show reviews",
            "list reviews",
            "feedback reviews",
            "customer reviews",
            "internal reviews",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "reviews"},
    ),
    IntentHeuristicRule(
        name="reviewers_query_rule",
        contains_any=[
            "reviewers",
            "reviewer list",
            "list reviewers",
            "show reviewers",
            "who are the reviewers",
            "document reviewers",
            "policy reviewers",
            "proposal reviewers",
            "review committee",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "reviewers"},
    ),
    IntentHeuristicRule(
        name="review_rounds_query_rule",
        contains_any=[
            "review rounds",
            "review_rounds",
            "approval rounds",
            "policy review rounds",
            "proposal review rounds",
            "evaluation rounds",
            "round review stages",
            "rounds of review",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "review_rounds"},
    ),
    IntentHeuristicRule(
        name="review_requests_query_rule",
        contains_any=[
            "review requests",
            "review_requests",
            "pending review requests",
            "requests for review",
            "policy review requests",
            "proposal review requests",
            "document review requests",
            "who has requested review",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "review_requests"},
    ),
    IntentHeuristicRule(
        name="retention_rules_query_rule",
        contains_any=[
            "retention rules",
            "retention_rules",
            "data retention rules",
            "record retention",
            "retention schedule",
            "retention policy",
            "how long do we retain",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "retention_rules"},
    ),
    IntentHeuristicRule(
        name="resolutions_query_rule",
        contains_any=[
            "resolutions",
            "board resolutions",
            "policy resolutions",
            "meeting resolutions",
            "adopted resolutions",
            "approved resolutions",
            "resolution records",
            "list resolutions",
            "show resolutions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "resolutions"},
    ),
    IntentHeuristicRule(
        name="requirements_query_rule",
        contains_any=[
            "requirements",
            "requirement records",
            "list requirements",
            "show requirements",
            "program requirements",
            "graduation requirements",
            "course requirements",
            "eligibility requirements",
            "policy requirements",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "requirements"},
    ),
    IntentHeuristicRule(
        name="report_cards_query_rule",
        contains_any=[
            "report_cards",
            "report cards",
            "show report cards",
            "list report cards",
            "student report cards",
            "grade report cards",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "report_cards"},
    ),
    IntentHeuristicRule(
        name="publications_query_rule",
        contains_any=[
            "publications",
            "district publications",
            "board publications",
            "policy publications",
            "meeting publications",
            "show publications",
            "list publications",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "publications"},
    ),
    IntentHeuristicRule(
        name="proposals_query_rule",
        contains_any=[
            "proposals",
            "proposal list",
            "district proposals",
            "board proposals",
            "grant proposals",
            "show proposals",
            "list proposals",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "proposals"},
    ),
    IntentHeuristicRule(
        name="proposal_reviews_query_rule",
        contains_any=[
            "proposal reviews",
            "reviews of proposals",
            "review scores",
            "grant proposal reviews",
            "show proposal reviews",
            "list proposal reviews",
            "proposal review list",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "proposal_reviews"},
    ),
    IntentHeuristicRule(
        name="proposal_documents_query_rule",
        contains_any=[
            "proposal documents",
            "documents for proposals",
            "proposal document list",
            "show proposal documents",
            "list proposal documents",
            "grant proposal documents",
            "attached proposal documents",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "proposal_documents"},
    ),
    IntentHeuristicRule(
        name="projects_query_rule",
        contains_any=[
            "projects",
            "project list",
            "show projects",
            "list projects",
            "district projects",
            "grant projects",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "projects"},
    ),
    IntentHeuristicRule(
        name="project_tasks_query_rule",
        contains_any=[
            "project tasks",
            "tasks for projects",
            "project task list",
            "show project tasks",
            "list project tasks",
            "district project tasks",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "project_tasks"},
    ),
    IntentHeuristicRule(
        name="posts_query_rule",
        contains_any=[
            "posts",
            "post list",
            "show posts",
            "list posts",
            "district posts",
            "blog posts",
            "news posts",
            "view posts",
            "see posts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "posts"},
    ),
    IntentHeuristicRule(
        name="post_attachments_query_rule",
        contains_any=[
            "post attachments",
            "attachments for posts",
            "post attachment list",
            "show post attachments",
            "list post attachments",
            "attached documents",
            "attached files",
            "files attached to posts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "post_attachments"},
    ),
    IntentHeuristicRule(
        name="policy_workflows_query_rule",
        contains_any=[
            "policy workflows",
            "policy_workflows",
            "policy approval workflows",
            "policy review workflows",
            "policy workflow list",
            "show policy workflows",
            "list policy workflows",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "policy_workflows"},
    ),
    IntentHeuristicRule(
        name="policy_workflow_steps_query_rule",
        contains_any=[
            "policy workflow steps",
            "steps in policy workflow",
            "policy_workflow_steps",
            "policy approval steps",
            "policy review steps",
            "show policy workflow steps",
            "list policy workflow steps",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "policy_workflow_steps"},
    ),
    IntentHeuristicRule(
        name="policy_versions_query_rule",
        contains_any=[
            "policy versions",
            "policy_versions",
            "versions of policies",
            "policy version history",
            "show policy versions",
            "list policy versions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "policy_versions"},
    ),
    IntentHeuristicRule(
        name="policy_search_index_query_rule",
        contains_any=[
            "policy search index",
            "policy_search_index",
            "searchable policies",
            "policy search metadata",
            "policy index records",
            "show policy search index",
            "list policy search index",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "policy_search_index"},
    ),
    IntentHeuristicRule(
        name="policy_publications_query_rule",
        contains_any=[
            "policy publications",
            "policy_publications",
            "published policies",
            "policy communication",
            "policy publication list",
            "show policy publications",
            "list policy publications",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "policy_publications"},
    ),
    IntentHeuristicRule(
        name="policy_legal_refs_query_rule",
        contains_any=[
            "policy legal references",
            "policy legal refs",
            "policy_legal_refs",
            "legal citations for policies",
            "policy citations",
            "legal references for policies",
            "show policy legal refs",
            "list policy legal refs",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "policy_legal_refs"},
    ),
    IntentHeuristicRule(
        name="policy_files_query_rule",
        contains_any=[
            "policy files",
            "policy_files",
            "files for policies",
            "policy file attachments",
            "policy documents files",
            "show policy files",
            "list policy files",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "policy_files"},
    ),
    IntentHeuristicRule(
        name="policy_comments_query_rule",
        contains_any=[
            "policy comments",
            "policy feedback",
            "comments on policies",
            "policy_comments",
            "show policy comments",
            "list policy comments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "policy_comments"},
    ),
    IntentHeuristicRule(
        name="policy_approvals_query_rule",
        contains_any=[
            "policy approvals",
            "policy_approvals",
            "approvals for policies",
            "policy approval steps",
            "policy approval records",
            "show policy approvals",
            "list policy approvals",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "policy_approvals"},
    ),
    IntentHeuristicRule(
        name="policies_query_rule",
        contains_any=[
            "policies",
            "district policies",
            "board policies",
            "policy list",
            "list of policies",
            "show policies",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "policies"},
    ),
    IntentHeuristicRule(
        name="pm_work_generators_query_rule",
        contains_any=[
            "pm work generators",
            "pm_work_generators",
            "plan work generators",
            "work generators for plans",
            "work generation templates",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "pm_work_generators"},
    ),
    IntentHeuristicRule(
        name="pm_plans_query_rule",
        contains_any=[
            "pm plans",
            "pm_plans",
            "project management plans",
            "performance management plans",
            "pm plan list",
            "show pm plans",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "pm_plans"},
    ),
    IntentHeuristicRule(
        name="ell_plans_query_rule",
        contains_any=[
            "ell plans",
            "ell_plans",
            "english learner plans",
            "english language learner plans",
            "esl plans",
            "show ell plans",
            "list ell plans",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "ell_plans"},
    ),
    IntentHeuristicRule(
        name="plans_query_rule",
        contains_any=[
            "plan list",
            "list of plans",
            "district plans",
            "strategic plans",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "plans"},
    ),
    IntentHeuristicRule(
        name="plan_search_index_query_rule",
        contains_any=[
            "plan search index",
            "plan_search_index",
            "searchable plans",
            "plan search metadata",
            "plan index records",
            "show plan search index",
            "list plan search index",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "plan_search_index"},
        ),
    IntentHeuristicRule(
        name="plan_filters_query_rule",
        contains_any=[
            "plan filters",
            "plan_filters",
            "saved plan filters",
            "plan filter presets",
            "filter presets for plans",
            "show plan filters",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "plan_filters"},
    ),
    IntentHeuristicRule(
        name="plan_assignments_query_rule",
        contains_any=[
            "plan assignments",
            "plan_assignments",
            "assignments for plans",
            "who is assigned to plans",
            "show plan assignments",
            "list plan assignments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "plan_assignments"},
    ),
    IntentHeuristicRule(
        name="plan_alignments_query_rule",
        contains_any=[
            "plan alignments",
            "plan_alignments",
            "alignment between plans",
            "plans aligned to",
            "show plan alignments",
            "list plan alignments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "plan_alignments"},
    ),
    IntentHeuristicRule(
        name="persons_query_rule",
        contains_any=[
            "person list",
            "list of people",
            "show persons",
            "list persons"
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "persons"},
    ),
    IntentHeuristicRule(
        name="personal_notes_query_rule",
        contains_any=[
            "personal notes",
            "notes about person",
            "student notes",
            "staff notes",
            "personal_notes",
            "show personal notes",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "personal_notes"},
    ),
    IntentHeuristicRule(
        name="person_contacts_query_rule",
        contains_any=[
            "person contacts",
            "contact info",
            "contact information",
            "phone numbers",
            "email addresses",
            "person_contacts",
            "show person contacts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "person_contacts"},
    ),
    IntentHeuristicRule(
        name="person_addresses_query_rule",
        contains_any=[
            "person addresses",
            "home address",
            "mailing address",
            "address for person",
            "person_addresses",
            "show person addresses",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "person_addresses"},
    ),
    IntentHeuristicRule(
        name="permissions_query_rule",
        contains_any=[
            "permissions",
            "access control",
            "who can do what",
            "acl",
            "permission records",
            "show permissions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "permissions"},
    ),
    IntentHeuristicRule(
        name="periods_query_rule",
        contains_any=[
            "periods",
            "reporting periods",
            "term periods",
            "grading periods",
            "show periods",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "periods"},
    ),
    IntentHeuristicRule(
        name="payroll_runs_query_rule",
        contains_any=[
            "payroll runs",
            "payroll_runs",
            "payroll run list",
            "list payroll runs",
            "show payroll runs",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "payroll_runs"},
    ),
    IntentHeuristicRule(
        name="payments_query_rule",
        contains_any=[
            "payments",
            "payment records",
            "payroll payments",
            "staff payments",
            "list payments",
            "show payments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "payments"},
    ),
    IntentHeuristicRule(
        name="paychecks_query_rule",
        contains_any=[
            "paychecks",
            "pay checks",
            "staff paychecks",
            "employee checks",
            "list paychecks",
            "show paychecks",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "paychecks"},
    ),
    IntentHeuristicRule(
        name="pay_periods_query_rule",
        contains_any=[
            "pay periods",
            "pay_periods",
            "payroll periods",
            "district pay periods",
            "list pay periods",
            "show pay periods",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "pay_periods"},
    ),
    IntentHeuristicRule(
        name="parts_query_rule",
        contains_any=[
            "inventory parts",
            "maintenance parts",
            "stock parts",
            "list parts",
            "show parts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "parts"},
    ),
    IntentHeuristicRule(
        name="part_locations_query_rule",
        contains_any=[
            "part locations",
            "part_locations",
            "where parts are stored",
            "inventory locations",
            "stock locations",
            "list part locations",
            "show part locations",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "part_locations"},
    ),
    IntentHeuristicRule(
        name="pages_query_rule",
        contains_any=[
            "pages",
            "site pages",
            "content pages",
            "page list",
            "show pages",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "pages"},
    ),
    IntentHeuristicRule(
        name="organizations_query_rule",
        contains_any=[
            "organizations",
            "orgs",
            "district organizations",
            "schools list",
            "list schools",
            "list buildings",
            "show organizations",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "organizations"},
    ),
    IntentHeuristicRule(
        name="orders_query_rule",
        contains_any=[
            "orders",
            "purchase orders",
            "work orders",
            "order list",
            "list orders",
            "show orders",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "orders"},
    ),
    IntentHeuristicRule(
        name="order_line_items_query_rule",
        contains_any=[
            "order line items",
            "order_line_items",
            "order details",
            "line items",
            "show order line items",
            "list order line items",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "order_line_items"},
    ),
    IntentHeuristicRule(
        name="objectives_query_rule",
        contains_any=[
            "objectives",
            "goals",
            "strategic objectives",
            "improvement objectives",
            "district goals",
            "show objectives",
            "list objectives",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "objectives"},
    ),
    IntentHeuristicRule(
        name="nurse_visits_query_rule",
        contains_any=[
            "nurse visits",
            "nurse_visits",
            "nurse office visits",
            "health office visits",
            "student nurse visits",
            "show nurse visits",
            "list nurse visits",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "nurse_visits"},
    ),
    IntentHeuristicRule(
        name="notifications_query_rule",
        contains_any=[
            "notifications",
            "alerts",
            "messages sent",
            "parent notifications",
            "staff notifications",
            "show notifications",
            "list notifications",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "notifications"},
    ),
    IntentHeuristicRule(
        name="move_orders_query_rule",
        contains_any=[
            "move orders",
            "move_orders",
            "inventory move orders",
            "transfer orders",
            "room move orders",
            "list move orders",
            "show move orders",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "move_orders"},
    ),
    IntentHeuristicRule(
        name="motions_query_rule",
        contains_any=[
            "motions",
            "board motions",
            "meeting motions",
            "voting motions",
            "show motions",
            "list motions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "motions"},
    ),
    IntentHeuristicRule(
        name="minutes_query_rule",
        contains_any=[
            "minutes",
            "meeting minutes",
            "board minutes",
            "show minutes",
            "list minutes",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "minutes"},
    ),
    IntentHeuristicRule(
        name="meters_query_rule",
        contains_any=[
            "meters",
            "utility meters",
            "energy meters",
            "building meters",
            "show meters",
            "list meters",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "meters"},
    ),
    IntentHeuristicRule(
        name="messages_query_rule",
        contains_any=[
            "messages",
            "internal messages",
            "staff messages",
            "message threads",
            "show messages",
            "list messages",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "messages"},
    ),
    IntentHeuristicRule(
        name="message_recipients_query_rule",
        contains_any=[
            "message recipients",
            "message_recipients",
            "who got messages",
            "notification recipients",
            "show message recipients",
            "list message recipients",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "message_recipients"},
    ),
    IntentHeuristicRule(
        name="memberships_query_rule",
        contains_any=[
            "memberships",
            "group memberships",
            "committee memberships",
            "board memberships",
            "show memberships",
            "list memberships",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "memberships"},
    ),
    IntentHeuristicRule(
        name="meetings_query_rule",
        contains_any=[
            "meetings",
            "board meetings",
            "school board meetings",
            "committee meetings",
            "show meetings",
            "list meetings",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "meetings"},
    ),
    IntentHeuristicRule(
        name="meeting_search_index_query_rule",
        contains_any=[
            "meeting search index",
            "meeting_search_index",
            "search meetings index",
            "meeting search metadata",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "meeting_search_index"},
    ),
    IntentHeuristicRule(
        name="meeting_publications_query_rule",
        contains_any=[
            "meeting publications",
            "meeting_publications",
            "board meeting publications",
            "published meetings",
            "show meeting publications",
            "list meeting publications",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "meeting_publications"},
    ),
    IntentHeuristicRule(
        name="meeting_permissions_query_rule",
        contains_any=[
            "meeting permissions",
            "meeting_permissions",
            "who can see meetings",
            "meeting access control",
            "show meeting permissions",
            "list meeting permissions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "meeting_permissions"},
    ),
    IntentHeuristicRule(
        name="meeting_files_query_rule",
        contains_any=[
            "meeting files",
            "meeting_files",
            "files attached to meetings",
            "board meeting files",
            "show meeting files",
            "list meeting files",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "meeting_files"},
    ),
    IntentHeuristicRule(
        name="meeting_documents_query_rule",
        contains_any=[
            "meeting documents",
            "meeting_documents",
            "documents attached to meetings",
            "board meeting documents",
            "show meeting documents",
            "list meeting documents",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "meeting_documents"},
    ),
    IntentHeuristicRule(
        name="medications_query_rule",
        contains_any=[
            "medications",
            "medication list",
            "nurse medications",
            "student medications",
            "show medications",
            "list medications",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "medications"},
    ),
    IntentHeuristicRule(
        name="medication_administrations_query_rule",
        contains_any=[
            "medication administrations",
            "medication_administrations",
            "med admin",
            "nurse medication administrations",
            "student medication administrations",
            "show medication administrations",
            "list medication administrations",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "medication_administrations"},
    ),
    IntentHeuristicRule(
        name="meal_transactions_query_rule",
        contains_any=[
            "meal transactions",
            "meal_transactions",
            "lunch transactions",
            "cafeteria transactions",
            "show meal transactions",
            "list meal transactions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "meal_transactions"},
    ),
    IntentHeuristicRule(
        name="meal_eligibility_statuses_query_rule",
        contains_any=[
            "meal eligibility",
            "meal eligibility statuses",
            "meal_eligibility_statuses",
            "lunch eligibility",
            "free reduced lunch status",
            "free and reduced lunch status",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "meal_eligibility_statuses"},
    ),
    IntentHeuristicRule(
        name="meal_accounts_query_rule",
        contains_any=[
            "meal accounts",
            "meal_accounts",
            "lunch accounts",
            "cafeteria accounts",
            "show meal accounts",
            "list meal accounts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "meal_accounts"},
    ),
    IntentHeuristicRule(
        name="maintenance_requests_query_rule",
        contains_any=[
            "maintenance requests",
            "maintenance_requests",
            "maintenance tickets",
            "work orders",
            "facility requests",
            "show maintenance requests",
            "list maintenance requests",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",  # could be reasonably more urgent
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "maintenance_requests"},
    ),
    IntentHeuristicRule(
        name="library_items_query_rule",
        contains_any=[
            "library items",
            "library catalog",
            "library books",
            "show library items",
            "search library catalog",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "library_items"},
    ),
    IntentHeuristicRule(
        name="library_holds_query_rule",
        contains_any=[
            "library holds",
            "library_holds",
            "book holds",
            "holds on books",
            "show library holds",
            "list library holds",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "library_holds"},
    ),
    IntentHeuristicRule(
        name="library_fines_query_rule",
        contains_any=[
            "library fines",
            "library_fines",
            "overdue fines",
            "book fines",
            "show library fines",
            "list library fines",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",  # money-related, mildly higher urgency
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "library_fines"},
    ),
    IntentHeuristicRule(
        name="library_checkouts_query_rule",
        contains_any=[
            "library checkouts",
            "library_checkouts",
            "checked out books",
            "books checked out",
            "show library checkouts",
            "list library checkouts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "library_checkouts"},
    ),
    IntentHeuristicRule(
        name="leases_query_rule",
        contains_any=[
            "leases",
            "facility leases",
            "equipment leases",
            "rental agreements",
            "show leases",
            "list leases",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "leases"},
    ),
    IntentHeuristicRule(
        name="materials_query_rule",
        contains_any=[
            "materials",
            "materials list",
            "material list",
            "supply list",
            "supplies list",
            "classroom materials",
            "teaching materials",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "materials"},
    ),
    IntentHeuristicRule(
        name="live_scorings_query_rule",
        contains_any=[
            "live scoring",
            "live score",
            "live scores",
            "live game",
            "game score",
            "show live scores",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",  # “live” implies some urgency
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "live_scorings"},
    ),
    IntentHeuristicRule(
        name="kpis_query_rule",
        contains_any=[
            "kpis",
            "kpi dashboard",
            "key performance indicators",
            "performance metrics",
            "district kpis",
            "osss kpis",
            "show kpis",
            "list kpis",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "kpis"},
    ),
    IntentHeuristicRule(
        name="kpi_datapoints_query_rule",
        contains_any=[
            "kpi datapoints",
            "kpi_datapoints",
            "kpi values",
            "kpi history",
            "kpi trend",
            "kpi time series",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "kpi_datapoints"},
    ),
    IntentHeuristicRule(
        name="journal_entry_lines_query_rule",
        contains_any=[
            "journal entry lines",
            "journal_entry_lines",
            "gl lines",
            "ledger lines",
            "show journal entry lines",
            "list journal entry lines",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "journal_entry_lines"},
    ),
    IntentHeuristicRule(
        name="journal_entries_query_rule",
        contains_any=[
            "journal entries",
            "journal_entries",
            "gl entries",
            "general ledger entries",
            "show journal entries",
            "list journal entries",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "journal_entries"},
    ),
    IntentHeuristicRule(
        name="journal_batches_query_rule",
        contains_any=[
            "journal batches",
            "journal_batches",
            "gl batches",
            "ledger batches",
            "show journal batches",
            "list journal batches",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "journal_batches"},
    ),
    IntentHeuristicRule(
        name="invoices_query_rule",
        contains_any=[
            "invoices",
            "invoice list",
            "vendor invoices",
            "student invoices",
            "district invoices",
            "show invoices",
            "list invoices",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",  # money-related
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "invoices"},
    ),
    IntentHeuristicRule(
        name="initiatives_query_rule",
        contains_any=[
            "initiatives",
            "strategic initiatives",
            "district initiatives",
            "osss initiatives",
            "school initiatives",
            "improvement initiatives",
            "show initiatives",
            "list initiatives",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "initiatives"},
    ),
    IntentHeuristicRule(
        name="incidents_query_rule",
        contains_any=[
            "incidents",
            "discipline incidents",
            "behavior incidents",
            "student incidents",
            "incident log",
            "incident report list",
            "show incidents",
            "list incidents",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",  # could be important but not always emergent
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "incidents"},
    ),
    IntentHeuristicRule(
        name="incident_participants_query_rule",
        contains_any=[
            "incident participants",
            "incident_participants",
            "incident people",
            "who was involved in the incident",
            "incident student list",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "incident_participants"},
    ),
    IntentHeuristicRule(
        name="immunizations_query_rule",
        contains_any=[
            "immunizations",
            "immunization types",
            "required immunizations",
            "vaccine requirements",
            "district immunizations",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "immunizations"},
    ),
    IntentHeuristicRule(
        name="immunization_records_query_rule",
        contains_any=[
            "immunization records",
            "immunization_records",
            "student immunizations",
            "vaccine records",
            "student vaccine records",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="high",  # compliance/health-related
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "immunization_records"},
    ),
    IntentHeuristicRule(
        name="iep_plans_query_rule",
        contains_any=[
            "iep plans",
            "iep_plans",
            "IEP list",
            "student IEPs",
            "special education plans",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="high",  # legally/academically important
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "iep_plans"},
    ),
    IntentHeuristicRule(
        name="hr_positions_query_rule",
        contains_any=[
            "hr positions",
            "hr_positions",
            "job positions",
            "position catalog",
            "staff positions",
            "show hr positions",
            "list hr positions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "hr_positions"},
    ),
    IntentHeuristicRule(
        name="hr_position_assignments_query_rule",
        contains_any=[
            "hr position assignments",
            "hr_position_assignments",
            "staff assignments",
            "position assignments",
            "who is in this position",
            "who holds this position",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "hr_position_assignments"},
    ),
    IntentHeuristicRule(
        name="hr_employees_query_rule",
        contains_any=[
            "hr employees",
            "hr_employees",
            "staff directory",
            "employee directory",
            "employee list",
            "show employees",
            "list employees",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="medium",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "hr_employees"},
    ),
    IntentHeuristicRule(
        name="health_profiles_query_rule",
        contains_any=[
            "health profiles",
            "health_profiles",
            "student health profiles",
            "medical profiles",
            "student medical info",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="high",  # health/safety related
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "health_profiles"},
    ),
    IntentHeuristicRule(
        name="guardians_query_rule",
        contains_any=[
            "guardians",
            "student guardians",
            "parent contacts",
            "family contacts",
            "guardian list",
            "guardian contact list",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="high",  # emergency contact / comms
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "guardians"},
    ),
    IntentHeuristicRule(
        name="grading_periods_query_rule",
        contains_any=[
            "grading periods",
            "grading_periods",
            "grading terms",
            "report card periods",
            "marking periods",
            "terms and quarters",
            "term dates",
            "quarter dates",
            "semester dates",
            "show grading periods",
            "list grading periods",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "grading_periods"},
    ),
    IntentHeuristicRule(
        name="gradebook_entries_query_rule",
        contains_any=[
            "gradebook entries",
            "gradebook_entries",
            "gradebook",
            "student grades",
            "student grade details",
            "class grades",
            "assignment grades",
            "assignment scores",
            "test scores",
            "quiz scores",
            "exam scores",
            "points earned",
            "points possible",
            "show grades",
            "list grades",
            "show gradebook",
            "export gradebook",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "gradebook_entries"},
    ),
    IntentHeuristicRule(
        name="grade_scales_query_rule",
        contains_any=[
            "grade scales",
            "grade_scales",
            "grading scale",
            "grading scales",
            "letter grade scale",
            "numeric grade scale",
            "gpa scale",
            "4.0 scale",
            "grading thresholds",
            "grade thresholds",
            "grade cutoffs",
            "grading cutoffs",
            "show grade scale",
            "list grade scales",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "grade_scales"},
        ),
    IntentHeuristicRule(
        name="grade_scale_bands_query_rule",
        contains_any=[
            "grade scale bands",
            "grade_scale_bands",
            "grading bands",
            "grade bands",
            "grade bands for scale",
            "letter grade bands",
            "percentage bands",
            "grade breakpoints",
            "grade cutoffs by band",
            "banded grade scale",
            "show grade scale bands",
            "list grade scale bands",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "grade_scale_bands"},
    ),
    IntentHeuristicRule(
        name="grade_levels_query_rule",
        contains_any=[
            "grade levels",
            "grade_levels",
            "k-12 grade levels",
            "k12 grade levels",
            "elementary grades",
            "middle school grades",
            "high school grades",
            "school grade structure",
            "list grade levels",
            "show grade levels",
            "what grades does this school have",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "grade_levels"},
    ),
    IntentHeuristicRule(
        name="gpa_calculations_query_rule",
        contains_any=[
            "gpa calculations",
            "gpa_calculations",
            "calculate gpa",
            "student gpa",
            "term gpa",
            "cumulative gpa",
            "weighted gpa",
            "unweighted gpa",
            "gpa result",
            "gpa details",
            "show gpa",
            "list gpa records",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "gpa_calculations"},
    ),
    IntentHeuristicRule(
        name="governing_bodies_query_rule",
        contains_any=[
            "governing bodies",
            "governing_bodies",
            "school board",
            "board of education",
            "district governing body",
            "district governance",
            "governance body",
            "oversight body",
            "list governing bodies",
            "show governing bodies",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "governing_bodies"},
    ),

    IntentHeuristicRule(
        name="goals_query_rule",
        contains_any=[
            "goals",
            "student goals",
            "academic goals",
            "behavior goals",
            "district goals",
            "school improvement goals",
            "iep goals",
            "list goals",
            "show goals",
            "what goals are set",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "goals"},
    ),
    IntentHeuristicRule(
        name="gl_segments_query_rule",
        contains_any=[
            "gl segments",
            "gl_segments",
            "general ledger segments",
            "chart of accounts segments",
            "accounting segments",
            "fund segments",
            "function segments",
            "project segments",
            "list gl segments",
            "show gl segments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "gl_segments"},
    ),
    IntentHeuristicRule(
        name="gl_segment_values_query_rule",
        contains_any=[
            "gl segment values",
            "gl_segment_values",
            "general ledger segment values",
            "chart of accounts values",
            "accounting segment values",
            "coas segment values",
            "segment value list",
            "list gl segment values",
            "show gl segment values",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "gl_segment_values"},
    ),
    IntentHeuristicRule(
        name="gl_accounts_query_rule",
        contains_any=[
            "gl accounts",
            "gl_accounts",
            "general ledger accounts",
            "chart of accounts",
            "coa accounts",
            "accounting accounts",
            "financial accounts",
            "list gl accounts",
            "show gl accounts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "gl_accounts"},
    ),
    IntentHeuristicRule(
        name="gl_account_segments_query_rule",
        contains_any=[
            "gl account segments",
            "gl_account_segments",
            "account segment mapping",
            "general ledger account segments",
            "chart of accounts segments mapping",
            "coa account segments",
            "list gl account segments",
            "show gl account segments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "gl_account_segments"},
    ),
    IntentHeuristicRule(
        name="frameworks_query_rule",
        contains_any=[
            "frameworks",
            "academic frameworks",
            "curriculum frameworks",
            "instructional frameworks",
            "standards frameworks",
            "list frameworks",
            "show frameworks",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "frameworks"},
    ),
    IntentHeuristicRule(
        name="folders_query_rule",
        contains_any=[
            "folders",
            "osss folders",
            "content folders",
            "data folders",
            "folder list",
            "list folders",
            "show folders",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "folders"},
    ),
    IntentHeuristicRule(
        name="floors_query_rule",
        contains_any=[
            "floors",
            "building floors",
            "school floors",
            "campus floors",
            "floor list",
            "list floors",
            "show floors",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "floors"},
    ),
    IntentHeuristicRule(
        name="fiscal_years_query_rule",
        contains_any=[
            "fiscal years",
            "fiscal_years",
            "finance years",
            "budget years",
            "accounting years",
            "list fiscal years",
            "show fiscal years",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "fiscal_years"},
    ),
    IntentHeuristicRule(
        name="fiscal_periods_query_rule",
        contains_any=[
            "fiscal periods",
            "fiscal_periods",
            "accounting periods",
            "finance periods",
            "budget periods",
            "period list",
            "list fiscal periods",
            "show fiscal periods",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "fiscal_periods"},
    ),
    IntentHeuristicRule(
        name="gl_account_balances_query_rule",
        contains_any=[
            "gl account balances",
            "gl_account_balances",
            "general ledger balances",
            "ledger balances",
            "trial balance",
            "account balances",
            "ending balances",
            "list gl account balances",
            "show gl account balances",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "gl_account_balances"},
    ),
    IntentHeuristicRule(
        name="final_grades_query_rule",
        contains_any=[
            "final grades",
            "final_grades",
            "final marks",
            "report card grades",
            "end of term grades",
            "posted grades",
            "list final grades",
            "show final grades",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "final_grades"},
    ),
    IntentHeuristicRule(
        name="evaluation_files_query_rule",
        contains_any=[
            "evaluation files",
            "evaluation_files",
            "evaluation artifacts",
            "observation artifacts",
            "evaluation attachments",
            "list evaluation files",
            "show evaluation files",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "evaluation_files"},
    ),
    IntentHeuristicRule(
        name="files_query_rule",
        contains_any=[
            "uploaded files",
            "osss files",
            "document files",
            "attachment files",
            "file list",
            "list files",
            "show files",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "files"},
    ),
    IntentHeuristicRule(
        name="fees_query_rule",
        contains_any=[
            "fees",
            "student fees",
            "school fees",
            "activity fees",
            "course fees",
            "fee list",
            "list fees",
            "show fees",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "fees"},
    ),
    IntentHeuristicRule(
        name="feature_flags_query_rule",
        contains_any=[
            "feature flags",
            "feature_flags",
            "feature toggles",
            "toggle flags",
            "app flags",
            "flag list",
            "list feature flags",
            "show feature flags",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "feature_flags"},
    ),
    IntentHeuristicRule(
        name="family_portal_access_query_rule",
        contains_any=[
            "family portal access",
            "family_portal_access",
            "parent portal access",
            "guardian portal access",
            "portal logins",
            "family accounts",
            "list family portal access",
            "show family portal access",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "family_portal_access"},
    ),
    IntentHeuristicRule(
        name="facilities_query_rule",
        contains_any=[
            "facilities",
            "school facilities",
            "district facilities",
            "campus buildings",
            "facility list",
            "list facilities",
            "show facilities",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "facilities"},
    ),
    IntentHeuristicRule(
        name="external_ids_query_rule",
        contains_any=[
            "external ids",
            "external_ids",
            "external id mapping",
            "sis ids",
            "state ids",
            "vendor ids",
            "mapping to external systems",
            "show external ids",
            "list external ids",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "external_ids"},
    ),
    IntentHeuristicRule(
        name="export_runs_query_rule",
        contains_any=[
            "export runs",
            "export_runs",
            "data export runs",
            "export history",
            "csv export runs",
            "job export runs",
            "list export runs",
            "show export runs",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "export_runs"},
    ),
    IntentHeuristicRule(
        name="events_query_rule",
        contains_any=[
            "events",
            "school events",
            "district events",
            "calendar events",
            "upcoming events",
            "event list",
            "list events",
            "show events",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "events"},
    ),
    IntentHeuristicRule(
        name="evaluation_templates_query_rule",
        contains_any=[
            "evaluation templates",
            "evaluation_templates",
            "teacher evaluation templates",
            "observation templates",
            "performance evaluation templates",
            "list evaluation templates",
            "show evaluation templates",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "evaluation_templates"},
    ),
    IntentHeuristicRule(
        name="evaluation_signoffs_query_rule",
        contains_any=[
            "evaluation signoffs",
            "evaluation_signoffs",
            "evaluation approvals",
            "observation signoffs",
            "teacher evaluation signoffs",
            "list evaluation signoffs",
            "show evaluation signoffs",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "evaluation_signoffs"},
    ),
    IntentHeuristicRule(
        name="evaluation_sections_query_rule",
        contains_any=[
            "evaluation sections",
            "evaluation_sections",
            "evaluation rubric sections",
            "observation sections",
            "teacher evaluation sections",
            "list evaluation sections",
            "show evaluation sections",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "evaluation_sections"},
    ),
    IntentHeuristicRule(
        name="evaluation_responses_query_rule",
        contains_any=[
            "evaluation responses",
            "evaluation_responses",
            "observation responses",
            "rubric responses",
            "evaluation answers",
            "teacher evaluation responses",
            "list evaluation responses",
            "show evaluation responses",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "evaluation_responses"},
    ),
    IntentHeuristicRule(
        name="evaluation_reports_query_rule",
        contains_any=[
            "evaluation reports",
            "evaluation_reports",
            "teacher evaluation reports",
            "performance evaluation reports",
            "observation reports",
            "list evaluation reports",
            "show evaluation reports",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "evaluation_reports"},
    ),
    IntentHeuristicRule(
        name="evaluation_questions_query_rule",
        contains_any=[
            "evaluation questions",
            "evaluation_questions",
            "evaluation rubric questions",
            "observation questions",
            "teacher evaluation questions",
            "list evaluation questions",
            "show evaluation questions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "evaluation_questions"},
    ),
    IntentHeuristicRule(
        name="evaluation_cycles_query_rule",
        contains_any=[
            "evaluation cycles",
            "evaluation_cycles",
            "evaluation cycle schedule",
            "teacher evaluation cycles",
            "observation cycles",
            "list evaluation cycles",
            "show evaluation cycles",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "evaluation_cycles"},
    ),
    IntentHeuristicRule(
        name="evaluation_assignments_query_rule",
        contains_any=[
            "evaluation assignments",
            "evaluation_assignments",
            "assigned evaluations",
            "evaluator assignments",
            "evaluatee assignments",
            "list evaluation assignments",
            "show evaluation assignments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "evaluation_assignments"},
    ),
    IntentHeuristicRule(
        name="entity_tags_query_rule",
        contains_any=[
            "entity tags",
            "entity_tags",
            "tags on folders",
            "tags on files",
            "show entity tags",
            "list entity tags",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "entity_tags"},
    ),
    IntentHeuristicRule(
        name="employee_earnings_query_rule",
        contains_any=[
            "employee earnings",
            "employee_earnings",
            "payroll earnings",
            "staff earnings",
            "salary earnings",
            "show employee earnings",
            "list employee earnings",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "employee_earnings"},
    ),
    IntentHeuristicRule(
        name="employee_deductions_query_rule",
        contains_any=[
            "employee deductions",
            "employee_deductions",
            "payroll deductions",
            "staff deductions",
            "benefit deductions",
            "show employee deductions",
            "list employee deductions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "employee_deductions"},
    ),
    IntentHeuristicRule(
        name="embeds_query_rule",
        contains_any=[
            "embeds",
            "embeddings",
            "vector index",
            "rag index entries",
            "osss embeddings",
            "list embeds",
            "show embeds",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "embeds"},
    ),
    IntentHeuristicRule(
        name="education_associations_query_rule",
        contains_any=[
            "education associations",
            "education_associations",
            "student-school associations",
            "staff-school associations",
            "enrollment associations",
            "show education associations",
            "list education associations",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "education_associations"},
    ),
    IntentHeuristicRule(
        name="earning_codes_query_rule",
        contains_any=[
            "earning codes",
            "earning_codes",
            "payroll earning codes",
            "pay codes",
            "payroll codes",
            "show earning codes",
            "list earning codes",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "earning_codes"},
    ),
    IntentHeuristicRule(
        name="documents_query_rule",
        contains_any=[
            "district documents",
            "school documents",
            "policy documents",
            "show documents",
            "list documents",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "documents"},
    ),
    IntentHeuristicRule(
        name="document_versions_query_rule",
        contains_any=[
            "document versions",
            "document_versions",
            "version history",
            "document history",
            "show document versions",
            "list document versions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "document_versions"},
    ),
    IntentHeuristicRule(
        name="document_search_index_query_rule",
        contains_any=[
            "document search index",
            "document_search_index",
            "indexed documents",
            "document keywords",
            "show document search index",
            "list document search index",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "document_search_index"},
    ),
    IntentHeuristicRule(
        name="document_permissions_query_rule",
        contains_any=[
            "document permissions",
            "document_permissions",
            "who can see this document",
            "document access",
            "document sharing",
            "show document permissions",
            "list document permissions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "document_permissions"},
    ),
    IntentHeuristicRule(
        name="document_notifications_query_rule",
        contains_any=[
            "document notifications",
            "document_notifications",
            "who was notified",
            "document acknowledgement",
            "document alerts",
            "show document notifications",
            "list document notifications",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "document_notifications"},
    ),
    IntentHeuristicRule(
        name="document_links_query_rule",
        contains_any=[
            "document links",
            "document_links",
            "related documents",
            "document relationships",
            "show document links",
            "list document links",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "document_links"},
    ),
    IntentHeuristicRule(
        name="document_activity_query_rule",
        contains_any=[
            "document activity",
            "document_activity",
            "document audit log",
            "document history",
            "who viewed this document",
            "who edited this document",
            "show document activity",
            "list document activity",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "document_activity"},
    ),
    IntentHeuristicRule(
        name="departments_query_rule",
        contains_any=[
            "departments",
            "school departments",
            "district departments",
            "department list",
            "show departments",
            "list departments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "departments"},
    ),
    IntentHeuristicRule(
        name="department_position_index_query_rule",
        contains_any=[
            "department position index",
            "department_position_index",
            "department staffing index",
            "fte by department",
            "positions by department",
            "show department position index",
            "list department position index",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "department_position_index"},
    ),
    IntentHeuristicRule(
        name="deliveries_query_rule",
        contains_any=[
            "deliveries",
            "delivery records",
            "shipment deliveries",
            "po deliveries",
            "show deliveries",
            "list deliveries",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "deliveries"},
    ),
    IntentHeuristicRule(
        name="deduction_codes_query_rule",
        contains_any=[
            "deduction codes",
            "deduction_codes",
            "payroll deduction codes",
            "benefit codes",
            "garnishment codes",
            "show deduction codes",
            "list deduction codes",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "deduction_codes"},
    ),
    IntentHeuristicRule(
        name="data_sharing_agreements_query_rule",
        contains_any=[
            "data sharing agreements",
            "data_sharing_agreements",
            "vendor data agreements",
            "student data sharing agreements",
            "dpa agreements",
            "show data sharing agreements",
            "list data sharing agreements",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "data_sharing_agreements"},
    ),
    IntentHeuristicRule(
        name="data_quality_issues_query_rule",
        contains_any=[
            "data quality issues",
            "data_quality_issues",
            "dq issues",
            "data validation issues",
            "data quality problems",
            "show data quality issues",
            "list data quality issues",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "data_quality_issues"},
    ),
    IntentHeuristicRule(
        name="curricula_query_rule",
        contains_any=[
            "curricula",
            "curriculum list",
            "curriculum catalog",
            "show curricula",
            "list curricula",
            "available curricula",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "curricula"},
    ),
    IntentHeuristicRule(
        name="curriculum_units_query_rule",
        contains_any=[
            "curriculum units",
            "curriculum_units",
            "units in curriculum",
            "show curriculum units",
            "list curriculum units",
            "scope and sequence units",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "curriculum_units"},
    ),
    IntentHeuristicRule(
        name="curriculum_versions_query_rule",
        contains_any=[
            "curriculum versions",
            "curriculum_versions",
            "curriculum version history",
            "versions of this curriculum",
            "show curriculum versions",
            "list curriculum versions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "curriculum_versions"},
    ),
    IntentHeuristicRule(
        name="course_sections_query_rule",
        contains_any=[
            "course sections",
            "course_sections",
            "class sections",
            "sections for a course",
            "show course sections",
            "list course sections",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "course_sections"},
    ),
    IntentHeuristicRule(
        name="course_prerequisites_query_rule",
        contains_any=[
            "course prerequisites",
            "course_prerequisites",
            "course prereqs",
            "prereqs for this course",
            "show course prerequisites",
            "list course prerequisites",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "course_prerequisites"},
    ),
    IntentHeuristicRule(
        name="emergency_contacts_query_rule",
        contains_any=[
            "emergency contacts",
            "emergency_contacts",
            "student emergency contacts",
            "staff emergency contacts",
            "show emergency contacts",
            "list emergency contacts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "emergency_contacts"},
    ),
    IntentHeuristicRule(
        name="contacts_query_rule",
        contains_any=[
            "contact records",
            "parent contacts",
            "guardian contacts",
            "show contacts",
            "list contacts",
            "general contacts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "contacts"},
    ),
    IntentHeuristicRule(
        name="courses_query_rule",
        contains_any=[
            "courses",
            "course catalog",
            "course list",
            "available courses",
            "show courses",
            "list courses",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "courses"},
    ),
    IntentHeuristicRule(
        name="consequences_query_rule",
        contains_any=[
            "consequences",
            "behavior consequences",
            "discipline consequences",
            "show consequences",
            "list consequences",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "consequences"},
    ),
    IntentHeuristicRule(
        name="consequence_types_query_rule",
        contains_any=[
            "consequence types",
            "consequence_types",
            "discipline consequence types",
            "show consequence types",
            "list consequence types",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "consequence_types"},
    ),
    IntentHeuristicRule(
        name="consents_query_rule",
        contains_any=[
            "consents",
            "parent consents",
            "guardian consents",
            "data usage consents",
            "show consents",
            "list consents",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "consents"},
    ),
    IntentHeuristicRule(
        name="compliance_records_query_rule",
        contains_any=[
            "compliance records",
            "compliance_records",
            "training compliance",
            "background check compliance",
            "show compliance records",
            "list compliance records",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "compliance_records"},
    ),
    IntentHeuristicRule(
        name="committees_query_rule",
        contains_any=[
            "committees",
            "committee list",
            "district committees",
            "school committees",
            "show committees",
            "list committees",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "committees"},
    ),
    IntentHeuristicRule(
        name="comm_search_index_query_rule",
        contains_any=[
            "comm search index",
            "comm_search_index",
            "communication search index",
            "communications index",
            "search communications index",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "comm_search_index"},
    ),
    IntentHeuristicRule(
        name="class_ranks_query_rule",
        contains_any=[
            "class ranks",
            "class_ranks",
            "class rank",
            "graduation rank",
            "show class ranks",
            "list class ranks",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "class_ranks"},
    ),
    IntentHeuristicRule(
        name="channels_query_rule",
        contains_any=[
            "channels",
            "communication channels",
            "message channels",
            "show channels",
            "list channels",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "channels"},
    ),
    IntentHeuristicRule(
        name="calendars_query_rule",
        contains_any=[
            "calendars",
            "school calendars",
            "district calendars",
            "show calendars",
            "list calendars",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "calendars"},
    ),
    IntentHeuristicRule(
        name="calendar_days_query_rule",
        contains_any=[
            "calendar days",
            "calendar_days",
            "instructional days",
            "school days",
            "show calendar days",
            "list calendar days",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "calendar_days"},
    ),
    IntentHeuristicRule(
        name="bus_stops_query_rule",
        contains_any=[
            "bus stops",
            "bus_stops",
            "transportation stops",
            "show bus stops",
            "list bus stops",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "bus_stops"},
    ),
    IntentHeuristicRule(
        name="bus_stop_times_query_rule",
        contains_any=[
            "bus stop times",
            "bus_stop_times",
            "bus schedule",
            "transportation schedule",
            "show bus stop times",
            "list bus stop times",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "bus_stop_times"},
    ),
    IntentHeuristicRule(
        name="bus_routes_query_rule",
        contains_any=[
            "bus routes",
            "bus_routes",
            "transportation routes",
            "show bus routes",
            "list bus routes",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "bus_routes"},
    ),
    IntentHeuristicRule(
        name="buildings_query_rule",
        contains_any=[
            "buildings",
            "school buildings",
            "district buildings",
            "show buildings",
            "list buildings",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "buildings"},
    ),
    IntentHeuristicRule(
        name="bell_schedules_query_rule",
        contains_any=[
            "bell schedules",
            "bell_schedules",
            "daily schedule",
            "period schedule",
            "show bell schedules",
            "list bell schedules",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "bell_schedules"},
    ),
    IntentHeuristicRule(
        name="behavior_interventions_query_rule",
        contains_any=[
            "behavior interventions",
            "behavior_interventions",
            "behavior supports",
            "mtss interventions",
            "show behavior interventions",
            "list behavior interventions",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "behavior_interventions"},
    ),
    IntentHeuristicRule(
        name="behavior_codes_query_rule",
        contains_any=[
            "behavior codes",
            "behavior_codes",
            "discipline codes",
            "incident codes",
            "show behavior codes",
            "list behavior codes",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "behavior_codes"},
    ),
    IntentHeuristicRule(
        name="audit_logs_query_rule",
        contains_any=[
            "audit logs",
            "audit_logs",
            "activity logs",
            "change history",
            "show audit logs",
            "list audit logs",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "audit_logs"},
    ),
    IntentHeuristicRule(
        name="assignments_query_rule",
        contains_any=[
            "assignments",
            "class assignments",
            "course assignments",
            "show assignments",
            "list assignments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "assignments"},
    ),
    IntentHeuristicRule(
        name="assignment_categories_query_rule",
        contains_any=[
            "assignment categories",
            "assignment_categories",
            "gradebook categories",
            "grading categories",
            "show assignment categories",
            "list assignment categories",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "assignment_categories"},
    ),
    IntentHeuristicRule(
        name="assets_query_rule",
        contains_any=[
            "assets",
            "fixed assets",
            "inventory assets",
            "equipment inventory",
            "show assets",
            "list assets",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "assets"},
    ),
    IntentHeuristicRule(
        name="asset_parts_query_rule",
        contains_any=[
            "asset parts",
            "asset_parts",
            "spare parts",
            "replacement parts",
            "show asset parts",
            "list asset parts",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "asset_parts"},
    ),
    IntentHeuristicRule(
        name="approvals_query_rule",
        contains_any=[
            "approval queue",
            "pending approvals",
            "approval status",
            "show approvals",
            "list approvals",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "approvals"},
    ),
    IntentHeuristicRule(
        name="ap_vendors_query_rule",
        contains_any=[
            "ap vendors",
            "ap_vendors",
            "accounts payable vendors",
            "vendor list",
            "show ap vendors",
            "list ap vendors",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "ap_vendors"},
    ),
    IntentHeuristicRule(
        name="alignments_query_rule",
        contains_any=[
            "alignments",
            "standard alignments",
            "curriculum alignments",
            "show alignments",
            "list alignments",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "alignments"},
    ),
    IntentHeuristicRule(
        name="agenda_workflows_query_rule",
        contains_any=[
            "agenda workflows",
            "agenda_workflows",
            "board agenda workflows",
            "workflow for agenda items",
            "show agenda workflows",
            "list agenda workflows",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "agenda_workflows"},
    ),
    IntentHeuristicRule(
        name="agenda_workflow_steps_query_rule",
        contains_any=[
            "agenda workflow steps",
            "agenda_workflow_steps",
            "agenda approval steps",
            "steps in the agenda workflow",
            "show agenda workflow steps",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "agenda_workflow_steps"},
    ),
    IntentHeuristicRule(
        name="agenda_items_query_rule",
        contains_any=[
            "agenda items",
            "agenda_items",
            "board agenda items",
            "meeting agenda items",
            "show agenda items",
            "list agenda items",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "agenda_items"},
    ),
    IntentHeuristicRule(
        name="agenda_item_files_query_rule",
        contains_any=[
            "agenda item files",
            "agenda_item_files",
            "agenda attachments",
            "attachments for agenda items",
            "show agenda item files",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "agenda_item_files"},
    ),
    IntentHeuristicRule(
        name="agenda_item_approvals_query_rule",
        contains_any=[
            "agenda item approvals",
            "agenda_item_approvals",
            "approvals for agenda items",
            "who approved this agenda item",
            "show agenda item approvals",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "agenda_item_approvals"},
    ),
    IntentHeuristicRule(
        name="addresses_query_rule",
        contains_any=[
            "addresses",
            "home addresses",
            "mailing addresses",
            "bus pickup addresses",
            "bus dropoff addresses",
            "show addresses",
            "list addresses",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "addresses"},
    ),
    IntentHeuristicRule(
        name="activities_query_rule",
        contains_any=[
            "activities",
            "student activities",
            "school activities",
            "athletics and activities",
            "list activities",
            "show activities",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "activities"},
    ),
    IntentHeuristicRule(
        name="accommodations_query_rule",
        contains_any=[
            "accommodations",
            "student accommodations",
            "testing accommodations",
            "classroom accommodations",
            "show accommodations",
            "list accommodations",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "accommodations"},
    ),
    IntentHeuristicRule(
        name="academic_terms_query_rule",
        contains_any=[
            "academic terms",
            "academic_terms",
            "semesters and trimesters",
            "school terms",
            "term dates",
            "semester dates",
            "show academic terms",
            "list academic terms",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "academic_terms"},
    ),
    IntentHeuristicRule(
        name="fan_app_settings_query_rule",
        contains_any=[
            "fan_app_settings",
            "fan app settings",
            "fan app config",
            "fan app configuration",
            "athletics app settings",
            "game day app settings",
            "fan app preferences",
            "fan experience settings",
            "list fan app settings",
            "show fan app settings",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "fan_app_settings"},
    ),
    IntentHeuristicRule(
        name="fan_pages_query_rule",
        contains_any=[
            "fan_pages",
            "fan pages",
            "fan page",
            "school fan page",
            "school fan pages",
            "athletics fan page",
            "game day fan page",
            "fan page content",
            "list fan pages",
            "show fan pages",
        ],
        regex=None,
        intent="query_data",
        action="read",
        urgency="low",
        tone_major="informal_casual",
        tone_minor="helpful",
        metadata={"mode": "fan_pages"},
    )



]

TABLES = []

# Auto-extend HEURISTIC_RULES
for table in TABLES:
    HEURISTIC_RULES.append(
        IntentHeuristicRule(
            name=f"{table}_query_rule",
            contains_any=[
                table,
                f"show {table}",
                f"{table} query",
            ],
            intent="query_data",
            action="read",
            urgency="low",
            tone_major="informal_casual",
            tone_minor="friendly",
            metadata={"mode": table},
        )
    )



def _apply_heuristics(text: str) -> Optional[IntentResult]:
    """
    Try to match the user's text against a list of heuristic rules.
    Returns an IntentResult if a rule fires, otherwise None.

    Also populates raw_model_output with a JSON blob that includes the
    full heuristic_rule and the original text, e.g.:

    {
      "source": "heuristic",
      "heuristic_rule": { ... rule fields ... },
      "text": "...",
      "llm": null
    }
    """
    lowered = (text or "").lower()

    for rule in HEURISTIC_RULES:
        matched = False

        if rule.contains_any:
            if any(kw in lowered for kw in rule.contains_any):
                matched = True

        if rule.regex and re.search(rule.regex, lowered):
            matched = True

        if not matched:
            continue

        logger.info(
            "[intent_classifier] heuristic rule matched: %s -> intent=%s",
            rule.name,
            rule.intent,
        )

        # Map rule.intent string => Intent enum safely
        try:
            intent_enum = Intent(rule.intent)
        except Exception:
            logger.warning(
                "[intent_classifier] heuristic rule produced unknown intent %r; "
                "falling back to GENERAL",
                rule.intent,
            )
            intent_enum = (
                Intent.GENERAL if hasattr(Intent, "GENERAL") else Intent("general")
            )

        # Debug bundle that will be surfaced to the caller via intent_raw_model_output
        bundle = {
            "source": "heuristic",
            "heuristic_rule": rule.model_dump(),
            "text": text,
            "llm": None,
        }
        bundle_json = json.dumps(bundle, ensure_ascii=False)

        return IntentResult(
            intent=intent_enum,
            confidence=0.95,
            raw={"heuristic_rule": rule.model_dump(), "text": text},
            action=rule.action,
            action_confidence=0.95,
            urgency=rule.urgency,
            urgency_confidence=0.8,
            tone_major=rule.tone_major,
            tone_major_confidence=0.8,
            tone_minor=rule.tone_minor,
            tone_minor_confidence=0.8,
            # For heuristics, we make both fields the same JSON string, so existing
            # consumers of raw_model_content keep working AND the router can pass
            # raw_model_output down to agents as intent_raw_model_output.
            raw_model_content=bundle_json,
            raw_model_output=bundle_json,
            source="heuristic",
        )

    return None


async def classify_intent(text: str) -> IntentResult:
    """
    Call the local LLM (Ollama / vLLM) to classify the user's text into:
      1) a semantic intent (OSSS.ai.intents.Intent),
      2) a CRUD-style action: "read", "create", "update", or "delete",
      3) an urgency level: "low", "medium", or "high",
      4) a major tone category and a more specific minor tone label.

    Heuristic rules are applied first; if any rule matches, we skip the LLM.
    """
    base = getattr(
        settings, "VLLM_ENDPOINT", "http://host.containers.internal:11434"
    ).rstrip("/")
    chat_url = f"{base}/v1/chat/completions"
    model = getattr(settings, "INTENT_MODEL", "llama3.2-vision")

    logger.info(
        "[intent_classifier] classifying text=%r",
        text[:300] if isinstance(text, str) else text,
    )
    logger.debug(
        "[intent_classifier] endpoint=%s model=%s",
        chat_url,
        model,
    )

    # --- 1) Heuristic fast-path ---------------------------------------------
    heuristic_result = _apply_heuristics(text)
    if heuristic_result is not None:
        # heuristic_result already has raw_model_output populated
        return heuristic_result

    # --- 2) SYSTEM PROMPT (TRIPLE-QUOTED TO AVOID QUOTING BUGS) -------------
    system = """
You are an intent classifier for questions about Dallas Center-Grimes (DCG) schools.
You must respond with ONLY a single JSON object on one line, for example:
{"intent":"general","confidence":0.92,
 "action":"read","action_confidence":0.88,
 "urgency":"low","urgency_confidence":0.74,
 "tone_major":"informal_casual","tone_major_confidence":0.80,
 "tone_minor":"friendly","tone_minor_confidence":0.83}

... (prompt truncated for brevity in this excerpt; keep your full prompt here) ...
"""

    messages = [
        {"role": "system", "content": system},
        {"role": "user", "content": text},
    ]

    # ---- Call upstream LLM -------------------------------------------------
    try:
        async with httpx.AsyncClient(timeout=10.0) as client:
            resp = await client.post(
                chat_url,
                json={
                    "model": model,
                    "messages": messages,
                    "temperature": 0.0,
                    "stream": False,
                },
            )
            logger.info(
                "[intent_classifier] upstream_v1 status=%s bytes=%s",
                resp.status_code,
                len(resp.content),
            )
            resp.raise_for_status()
            data = resp.json()
    except httpx.HTTPError as e:
        logger.error(
            "[intent_classifier] HTTP error when calling %s: %s (falling back to general intent)",
            chat_url,
            e,
        )
        fallback_intent = (
            Intent.GENERAL if hasattr(Intent, "GENERAL") else Intent("general")
        )
        # Even on fallback, populate raw_model_output so downstream can see what happened
        bundle = {
            "source": "fallback",
            "heuristic_rule": None,
            "text": text,
            "llm": {
                "error": str(e),
                "endpoint": chat_url,
            },
        }
        bundle_json = json.dumps(bundle, ensure_ascii=False)
        return IntentResult(
            intent=fallback_intent,
            confidence=None,
            raw={"error": str(e)},
            action=None,
            action_confidence=None,
            urgency=None,
            urgency_confidence=None,
            tone_major=None,
            tone_major_confidence=None,
            tone_minor=None,
            tone_minor_confidence=None,
            raw_model_content=None,
            raw_model_output=bundle_json,
            source="fallback",
        )

    # ---- Extract raw content -----------------------------------------------
    content = (
        data.get("choices", [{}])[0]
        .get("message", {})
        .get("content", "")
        .strip()
    )
    logger.debug(
        "[intent_classifier] raw model content: %r",
        content[-500:] if isinstance(content, str) else content,
    )

    # ---- Try to parse the model output as JSON -----------------------------
    obj = None
    raw_intent = "general"
    confidence: Optional[float] = None
    raw_action: Optional[str] = None
    action_confidence: Optional[float] = None
    raw_urgency: Optional[str] = None
    urgency_confidence: Optional[float] = None
    raw_tone_major: Optional[str] = None
    tone_major_confidence: Optional[float] = None
    raw_tone_minor: Optional[str] = None
    tone_minor_confidence: Optional[float] = None

    if isinstance(content, str) and content.lstrip().startswith("{"):
        try:
            obj = json.loads(content)
            raw_intent = obj.get("intent", "general")
            confidence = obj.get("confidence")

            raw_action = obj.get("action")
            action_confidence = obj.get("action_confidence")

            raw_urgency = obj.get("urgency")
            urgency_confidence = obj.get("urgency_confidence")

            raw_tone_major = obj.get("tone_major")
            tone_major_confidence = obj.get("tone_major_confidence")

            raw_tone_minor = obj.get("tone_minor")
            tone_minor_confidence = obj.get("tone_minor_confidence")

            logger.info(
                "[intent_classifier] parsed JSON obj=%s raw_intent=%r confidence=%r "
                "raw_action=%r action_confidence=%r raw_urgency=%r urgency_confidence=%r "
                "raw_tone_major=%r tone_major_confidence=%r "
                "raw_tone_minor=%r tone_minor_confidence=%r",
                obj,
                raw_intent,
                confidence,
                raw_action,
                action_confidence,
                raw_urgency,
                urgency_confidence,
                raw_tone_major,
                tone_major_confidence,
                raw_tone_minor,
                tone_minor_confidence,
            )
        except Exception as e:
            logger.warning(
                "[intent_classifier] JSON parse failed for content prefix=%r error=%s "
                "(falling back to general intent/read action)",
                content[:120],
                e,
            )
            obj = None
            raw_intent = "general"
            confidence = None
            raw_action = None
            action_confidence = None
            raw_urgency = None
            urgency_confidence = None
            raw_tone_major = None
            tone_major_confidence = None
            raw_tone_minor = None
            tone_minor_confidence = None
    else:
        logger.info(
            "[intent_classifier] model returned non-JSON content, falling back to general intent/read action"
        )

    # ---- Map string -> Intent enum safely ----------------------------------
    try:
        intent = Intent(raw_intent)
    except Exception as e:
        logger.warning(
            "[intent_classifier] unknown intent %r, falling back to GENERAL: %s",
            raw_intent,
            e,
        )
        intent = (
            Intent.GENERAL if hasattr(Intent, "GENERAL") else Intent("general")
        )

    # Normalize action
    if isinstance(raw_action, str):
        action_norm = raw_action.lower().strip()
        if action_norm not in {"read", "create", "update", "delete"}:
            logger.warning(
                "[intent_classifier] unknown action %r, setting action=None", raw_action
            )
            action_norm = None
    else:
        action_norm = None

    # Normalize urgency
    if isinstance(raw_urgency, str):
        urgency_norm = raw_urgency.lower().strip()
        if urgency_norm not in {"low", "medium", "high"}:
            logger.warning(
                "[intent_classifier] unknown urgency %r, setting urgency=None",
                raw_urgency,
            )
            urgency_norm = None
    else:
        urgency_norm = None

    # Normalize tone_major
    valid_tone_major = {
        "formal_professional",
        "informal_casual",
        "emotional_attitude",
        "action_persuasive",
        "other",
    }
    if isinstance(raw_tone_major, str):
        tone_major_norm = raw_tone_major.lower().strip()
        if tone_major_norm not in valid_tone_major:
            logger.warning(
                "[intent_classifier] unknown tone_major %r, setting tone_major=None",
                raw_tone_major,
            )
            tone_major_norm = None
    else:
        tone_major_norm = None

    # Normalize tone_minor
    valid_tone_minor = {
        "formal",
        "objective",
        "authoritative",
        "respectful",
        "informal",
        "casual",
        "friendly",
        "enthusiastic",
        "humorous",
        "optimistic",
        "pessimistic",
        "serious",
        "empathetic_compassionate",
        "assertive",
        "sarcastic",
        "persuasive",
        "encouraging",
        "didactic",
        "curious",
        "candid",
        "apologetic",
        "dramatic",
        "concerned",
    }
    if isinstance(raw_tone_minor, str):
        tone_minor_norm = raw_tone_minor.lower().strip()
        if tone_minor_norm not in valid_tone_minor:
            logger.warning(
                "[intent_classifier] unknown tone_minor %r, setting tone_minor=None",
                raw_tone_minor,
            )
            tone_minor_norm = None
    else:
        tone_minor_norm = None

    logger.info(
        "[intent_classifier] final intent=%s confidence=%r "
        "action=%r action_confidence=%r "
        "urgency=%r urgency_confidence=%r "
        "tone_major=%r tone_major_confidence=%r "
        "tone_minor=%r tone_minor_confidence=%r",
        getattr(intent, "value", str(intent)),
        confidence,
        action_norm,
        action_confidence,
        urgency_norm,
        urgency_confidence,
        tone_major_norm,
        tone_major_confidence,
        tone_minor_norm,
        tone_minor_confidence,
    )

    # Bundle for raw_model_output (LLM path)
    bundle = {
        "source": "llm",
        "heuristic_rule": None,
        "text": text,
        "llm": obj,  # parsed JSON if available, else None
    }
    bundle_json = json.dumps(bundle, ensure_ascii=False)

    return IntentResult(
        intent=intent,
        confidence=confidence,
        raw=obj or data,
        action=action_norm,
        action_confidence=action_confidence,
        urgency=urgency_norm,
        urgency_confidence=urgency_confidence,
        tone_major=tone_major_norm,
        tone_major_confidence=tone_major_confidence,
        tone_minor=tone_minor_norm,
        tone_minor_confidence=tone_minor_confidence,
        # raw_model_content = verbatim model content; raw_model_output = our structured bundle
        raw_model_content=content,
        raw_model_output=bundle_json,
        source="llm",
    )
